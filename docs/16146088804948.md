第六章 集合引用类型

[TOC]

# 6.1 Object
显式地创建 Object 的实例有两种方式。第一种是使用 new 操作符和 Object 构造函数。另一种方式是使用对象字面量(object literal)表示法。在对象字面量表示法中，属性名可以是字符串或数值。数值属性会自动转换为字符串。在最后一个属性后面加上逗号在非常老的浏览器中会导致报错，但所有现代浏览器都支持这种写法。

虽然属性一般是通过点语法来存取的，这也是面向对象语言的惯例，但也可以使用中括号来存取属性。在使用中括号时，要在括号内使用属性名的字符串形式。使用中括号的主要优势就是可以通过变量访问属性。如果属性名中包含可能会导致语法错误的字符，或者包含关键字/保留字时，也可以使用中括号语法。

# 6.2 Array
数组中每个槽位可以存储任意类型的数据。ECMAScript 数组也是动态大小的，会随着数据添加而自动增长。

## 6.2.1 创建数组
一种是使用 Array 构造函数。
也可以给 Array 构造函数传入要保存的元素。
创建数组时可以给构造函数传一个值。这时候就有点问题了，因为如果这个值是数值，则会创建一个长度为指定数值的数组;而如果这个值是其他类型的，则会创建一个只包含该特定值的数组。
在使用 Array 构造函数时，也可以省略 new 操作符，结果是一样的。

另一种创建数组的方式是使用数组字面量(array literal)表示法。数组字面量是在中括号中包含以 逗号分隔的元素列表。

Array 构造函数还有两个 ES6 新增的用于创建数组的静态方法:from()和 of()。from()用于将 类数组结构转换为数组实例，而 of()用于将一组参数转换为数组实例。

## 6.2.2 数组空位
使用数组字面量初始化数组时，可以使用一串逗号来创建空位(hole)。ECMAScript会将逗号之间相应索引位置的值当成空位，ES6 新增方法普遍将这些空位当成存在的元素，只不过值为 undefined。ES6 之前的方法则会忽略这个空位，但具体的行为也会因方法而异：
```const options = [1,,,,5];
// map()会跳过空位置
console.log(options.map(() => 6)); // [6, undefined, undefined, undefined, 6]
// join()视空位置为空字符串 console.log(options.join('-'));// "1----5"
```

## 6.2.3 数组索引
要取得或设置数组的值，需要使用中括号并提供相应值的数字索引。

如果把一个值设置给超过数组最大索引的索引，则数组长度会自动扩展到该索引值加 1。

数组中元素的数量保存在 length 属性中，这个属性始终返回 0 或大于 0 的值。数组 length 属性的独特之处在于，它不是只读的。通过修改 length 属性，可以从数组末尾删除或添加元素。

## 6.2.4 检测数组
一个经典的 ECMAScript 问题是判断一个对象是不是数组。在只有一个网页(因而只有一个全局作 用域)的情况下，使用 instanceof 操作符就足矣。

使用 instanceof 的问题是假定只有一个全局执行上下文。如果网页里有多个框架，则可能涉及两个不同的全局执行上下文，因此就会有两个不同版本的 Array 构造函数。如果要把数组从一个框架传 给另一个框架，则这个数组的构造函数将有别于在第二个框架内本地创建的数组。

为解决这个问题，ECMAScript 提供了 Array.isArray()方法。这个方法的目的就是确定一个值是 否为数组，而不用管它是在哪个全局执行上下文中创建的。

## 6.2.5 迭代器方法
在 ES6 中，Array 的原型上暴露了 3 个用于检索数组内容的方法:keys()、values()和 entries()。keys()返回数组索引的迭代器，values()返回数组元素的迭代器，而 entries()返回 索引/值对的迭代器。

使用 ES6 的解构可以非常容易地在循环中拆分键/值对: 
```
const a = ["foo", "bar", "baz", "qux"];
 for (const [idx, element] of a.entries()) { alert(idx);
alert(element);
}
```

## 6.2.6 复制和填充方法
ES6 新增了两个方法:批量复制方法 copyWithin()，以及填充数组方法 fill()。这两个方法的 函数签名类似，都需要指定既有数组实例上的一个范围，包含开始索引，不包含结束索引。使用这个方法不会改变数组的大小。

使用 fill()方法可以向一个已有的数组中插入全部或部分相同的值。开始索引用于指定开始填充的位置，它是可选的。如果不提供结束索引，则一直填充到数组末尾。负值索引从数组末尾开始计算。 也可以将负索引想象成数组长度加上它得到的一个正索引。

copyWithin()会按照指定范围浅复制数组中的部分内容，然后将它们插入到指 定索引开始的位置。开始索引和结束索引则与 fill()使用同样的计算方法。


## 6.2.7 转换方法
所有对象都有 toLocaleString()、toString()和 valueOf()方法。其中，valueOf() 返回的还是数组本身。而 toString()返回由数组中每个值的等效字符串拼接而成的一个逗号分隔的 字符串。也就是说，对数组的每个值都会调用其 toString()方法，以得到最终的字符串。

toLocaleString()方法也可能返回跟 toString()和 valueOf()相同的结果，但也不一定。在 调用数组的 toLocaleString()方法时，会得到一个逗号分隔的数组值的字符串。它与另外两个方法 唯一的区别是，为了得到最终的字符串，会调用数组每个值的 toLocaleString()方法，而不是 toString()方法。

## 6.2.8 栈方法
ECMAScript 数组提供了 push()和 pop()方法，以实现类似栈的行为。

push()方法接收任意数量的参数，并将它们添加到数组末尾，返回数组的最新长度。pop()方法则 用于删除数组的最后一项，同时减少数组的 length 值，返回被删除的项。

## 6.2.9 队列方法
使用 shift()和 push()，可以把数组当成队列来使用。

## 6.2.10 排序方法
默认情况下，sort()会按照升序重新排列数组元素，即最小的值在前面，最大的值在后面。为此， sort()会在每一项上调用 String()转型函数，然后比较字符串来决定顺序。即使数组的元素都是数值， 也会先把数组转换为字符串再比较、排序。

sort()方法可以接收一个比较函数，用于判断哪个值应该排在前面。比较函数接收两个参数，如果第一个参数应该排在第二个参数前面，就返回负值;如果两个参数相 等，就返回 0;如果第一个参数应该排在第二个参数后面，就返回正值。如果数组的元素是数值，或者是其 valueOf()方法返回数值的对象(如 Date 对象)，这时可以直接用第二个值减去第一个值。

reverse()方法就 是将数组元素反向排列。

## 6.2.11 操作方法
concat()方法可以在现有数组全部元素基础上 创建一个新数组。它首先会创建一个当前数组的副本，然后再把它的参数添加到副本末尾，最后返回这 个新构建的数组。如果传入一个或多个数组，则 concat()会把这些数组的每一项都添加到结果数组。 如果参数不是数组，则直接把它们添加到结果数组末尾。

splice()的主要目的是 在数组中间插入元素，但有 3 种不同的方式使用这个方法。

## 6.2.12 搜索和位置方法
1. 严格相等
ECMAScript 提供了 3 个严格相等的搜索方法:indexOf()、lastIndexOf()和 includes()。indexOf()和 lastIndexOf()都返回要查找的元素在数组中的位置，如果没找到则返回1。 includes()返回布尔值，表示是否至少找到一个与指定元素匹配的项。在比较第一个参数跟数组每一 项时，会使用全等(===)比较，也就是说两项必须严格相等。

2. 断言函数
ECMAScript 也允许按照定义的断言函数搜索数组，每个索引都会调用这个函数。断言函数接收 3 个参数:元素、索引和数组本身。find()和 findIndex()方法使用了断言函数。

## 6.2.13 迭代方法
ECMAScript 为数组定义了 5 个迭代方法。每个方法接收两个参数:以每一项为参数运行的函数， 以及可选的作为函数运行上下文的作用域对象(影响函数中 this 的值)。传给每个方法的函数接收 3 个参数:数组元素、元素索引和数组本身:
every,filter,forEach,map,some.

## 6.2.14 归并方法
ECMAScript 为数组提供了两个归并方法:reduce()和 reduceRight()。这两个方法都会迭代数 组的所有项，并在此基础上构建一个最终返回值。reduce()方法从数组第一项开始遍历到最后一项。 而 reduceRight()从最后一项开始遍历至第一项。

这两个方法都接收两个参数:对每一项都会运行的归并函数，以及可选的以之为归并起点的初始值。 传给 reduce()和 reduceRight()的函数接收 4 个参数:上一个归并值、当前项、当前项的索引和数 组本身。这个函数返回的任何值都会作为下一次调用同一个函数的第一个参数。如果没有给这两个方法 传入可选的第二个参数(作为归并起点值)，则第一次迭代将从数组的第二项开始，因此传给归并函数 的第一个参数是数组的第一项，第二个参数是数组的第二项。


# 6.3 定型数组
## 6.3.1 历史

## 6.3.2 ArrayBuffer


## 6.3.3 DataView



# 6.4 Map


# 6.5 WeakMap


# 6.6 Set


# 6.7 WeakSet

## 6.7.1 基本API
可以使用 new 关键字实例化一个空的 WeakSet。弱集合中的值只能是 Object 或者继承自 Object 的类型，尝试使用非对象设置值会抛出 TypeError。如果想在初始化时填充弱集合，则构造函数可以接收一个可迭代对象。

初始化之后可以使用 add()再添加新值，可以使用 has()查询，还可以使用 delete()删除。

## 6.7.2 弱值
WeakSet 中“weak”表示弱集合的值是“弱弱地拿着”的。意思就是，这些值不属于正式的引用，不会阻止垃圾回收。

## 6.7.3 不可迭代值
因为 WeakSet 中的值任何时候都可能被销毁，所以没必要提供迭代其值的能力。

# 6.8 迭代与扩展操作