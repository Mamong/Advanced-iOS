第四章 返回结果的HTTP状态

[TOC]

HTTP状态码负责表示客户端HTTP请求的返回结果、标记服务端的处理是否正常、通知出现的错误等工作。

##4.1状态码告知从服务端返回的请求结果
状态码由3位数字和原因短语组成。数字第一位制定了响应类别，后两位没分类。
状态码类别：

|  | 类别 | 原因短语 |
| ------ | ------ | ------ |
| 1xx | informational（信息性状态码） | 接受的请求正在处理|
| 2xx | success（成功状态码） | 请求正正常处理完毕|
| 3xx | redirection（重定向状态码） | 需要进行附加操作以完成请求|
| 4xx | client error（客户端错误状态码） | 服务器无法处理请求|
| 5xx | server error（服务器错误状态码） | 服务器处理请求出错|

常用的14个状态码
##4.2 2xx成功
###4.2.1 200 OK
表示从客户端发来的请求在服务端被正常处理了。

###4.2.2 204 No Content
表示服务器接收的请求已成功处理，但在返回的响应报文中不含（也不允许包含）实体的主体部分。浏览器发出请求，返回204响应，显示的页面不发生更新。一般在只需从客户端往服务端发送消息，而不需要从服务端回消息的情况下使用。

###4.2.3 206 Partial Content
表示客户端进行了范围请求，服务端成功处理了该请求。响应报文中包含有Content-Range指定范围的实体内容。

##4.3 3xx重定向
###4.3.1 301 Moved Permanently
永久性重定向。表示请求的资源已被分配了新的URI，以后应使用资源现在所指的URI。新的URI在Location首部字段里。用户把URI保存成书签的话，应该重新保存。

###4.3.2 302 Found
临时性重定向。表示请求的资源已被分配了新的URI，希望本次能使用新的URI访问。用户把URI保存成书签的话，暂时不必重新保存，因为将来可能还会发生变化。

###4.3.3 303 See Other
表示由于请求对应的资源存在着另一个URI，应使用GET方法定向获取请求的资源。303和302类似，但303要求客户端采用GET方法获取资源。
>当301、302、303响应状态码返回时，几乎所有浏览器会把POST改成GET，并删除请求报文内的主体，之后请求会自动再次发送。
>301，302标注是禁止将POST方法改变成GET方法的，但实际使用时大家都会这么做

###4.3.4 304 Not Modified
表示客户端发送附带条件的请求时，服务端允许请求访问资源，但是未满足条件。304返回时，不包含任何请求的主体部分。和重定向无关。这里的请求附带条件指GET方法的请求报文中包含If-Match,If-None-Match,If-Range, If-Modified-Since,If-Unmodified-Since中任一首部。

###4.3.5 307 Temporary Redirect
临时重定向。和302同义。302禁止POST变换成GET，但实际使用时大家并不遵守。307会遵照浏览器标准，不会从POST转GET。

HTTP状态码302、303和307的故事
补充：https://www.cnblogs.com/cswuyg/p/3871976.html
302在HTTP1.0和1.1时意义相同：post请求不能直接向新的URI发起重复请求，必须跟用户确认。但是浏览器往往会把POST请求变为GET请求。
HTTP1.1引入了303和307：
303：对于POST请求，客户端可以接着使用GET去请求Location里的URI
307：post请求不能直接向新的URI发起重复请求，必须跟用户确认。

##4.4 4xx客户端错误
4xx表明客户端是发生错误的原因所在
###4.4.1 400 Bad Request
表示请求报文中存在语法错误。浏览器像处理200一样对待该状态。

###4.4.2 401 Unauthorized
表示发送的请求需要有通过HTTP认证（BASIC、DIGEST认证）的认证信息。若之前已进行过1次请求，则表示用户认证失败。
返回401的响应必须包含一个适用于被请求资源的WWW-Authenticate首部用以challenge用户信息。当浏览器初次接收到401响应，会弹出认证用的对话窗口。

###4.4.3 403 Forbidden
表示对请求资源的访问被服务器拒绝了。可选的，可以在实体主体部分对拒绝原因进行描述。

###4.4.4 404 Not Found
表示服务器上无法找到请求的资源。也可以用于未说明原因的请求拒绝。

###405 Method Not Allowed
不支持的方法

###406 Not Acceptable
客户端资源无法满足客户端请求的条件，例如请求需要中文但只有英文；

###408 Request Timeout
请求超时，服务器等待了过长的时间；

###409 Conflict
多个请求发生了冲突，可以理解为多线程并发时的竞态；

###412 Precondition Failed

###413 Request Entity Too Large：
请求报文里的 body 太大；

###414 Request-URI Too Long：请求行里的 URI 太大；

###429 Too Many Requests：客户端发送了太多的请求，
通常是由于服务器的限连策略；

###431 Request Header Fields Too Large：请求头某个字
段或总体太大；

##4.5 5XX服务器错误
5XX表示服务器本身发生错误
###4.5.1 500 Internal Server Error
表示服务端在执行时发生了错误。

### 502 Bad Gateway
通常是服务器作为网关或者代理时返回的错误码，表示服务器自身工作正常，访问后端服务器时发生了错误，但具体的错误原因也是不知道的。

###4.5.2 503 Service Unavailable
表示服务器暂时处于超负荷或正在停机维护，现在无法处理请求。如果事先得知解除  以上状况需要的时间，最好写入RetryAfter首部字段再返回给客户端。