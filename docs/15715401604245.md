#Linux Shell 命令（七中） sed的简单使用

[TOC]

##工作流
sed遵循简单的工作流：
1.读取（从输入中读取某一行）
2.执行（在某一行上执行sed命令）
3.显示（把结果显示在输出中）

默认是显示修改后内容，不会修改原文件，除非使用-i 参数。

##常用参数及命令
格式：
sed [-nefri]  'command' test.txt  （尽量按照标准格式使用单引号）
选项：
-n：       静默输出,关闭模式空间的输出,不会输出未匹配到的行 一般与p命令结合使用
-e：      允许进行多项编辑,也就是说对同一行做多次处理。可以做多点编辑-e '动作1'  -e '动作2'  ==  '动作1;动作2'
-f：        后接sed脚本,指定执行的sed脚本(将模式动作写到文件中)
-r：       允许使用扩展正则
-i：       直接作用于原文件，不输出到终端
-i.bak:  修改原文件之前进行备份

###动作命令：
1. d删除delete
2. p打印print
3. r读取read
4. w写write
5. a追加，在匹配的行下面插入内容append
6. i插入，在匹配行的上一行插入内容insert
7. c修改，本行替换change
8. y转换的命令,一一对应转换
9. n处理下一行next
10. q退出,不会再向模式空间读入新的行quit
11. s查找替换，'模式s/旧的内容(正则表达式)/替换内容(新的内容)/[修饰符]'

!    命令取反 例: 1!d 删除第一行以外的行

{}   命令组合 命令用分号分隔 {1h;G} 可以理解为 -e 参数的另一种写法

=   打印行号(输入行的号码,而非处理的次数行号) 例如： sed -n '2{=;p}' infile

n   读入下一行到模式空间 例:'4{n;d}' 删除第5行

N   追加下一行到模式空间.

P   输出多行模式空间的第一部分,直到第一个嵌入的换行符为止。在执行完脚本的最后一个命令之后,模式空间的内容自动输出。P命令经常出现在N命令之后和D命令之前。

D   删除模式空间中直到第一个换行符的内容。它不会导致读入新的输入行,相反,它返回到脚本的顶端,将这些指令应用与模式空间剩余的内容。

这三个命令能建立一个输入. 输出循环,用来维护两行模式空间,但是一次只输出一行。

这个循环的目的是只输出模式空间的第一行,然后返回到脚本的顶端将所有的命令应用于模式空间的第二行。没有这个循环,当执行脚本中的最后一个命令时,模式空间中的这两行都将被输出。

###修饰符：
g：全局替换
n：n为数字,1-512    替换第n个匹配到的内容
p：打印-n
w：把处理过的行写入到另一个文件

###空间：
1.模式空间：
用于处理文本行,最大保存8192字节

2.保留空间：
用于保留文本行,用来保存已经处理完的文本行,最大保存8192字节,默认有一个空行

###置换命令：
h：将模式空间的内容复制到保留空间 —— 覆盖模式

H：将模式空间的内容追加到保留空间 —— 追加模式

g：将保留空间的内容复制到模式空间 —— 覆盖模式

G：将保留空间的内容追加到模式空间 —— 追加模式

x：将模式空间和保留空间中的内容进行交换 

###模式:
1. 空模式
表示所有的行都执行动作

2. 以行号作为模式
1). 单独的行号，如：1  就是处理第1行；$  处理最后一行
2). 起始行,结束行， 如：1,5    处理第1到5行
3). 起始行~步长
每隔多少行操作一次， 如:2~2 从第2行开始,每隔1行
4). 起始位置,+N
表示从起始位置开始,后面的N行都进行处理， 如：3,+5  处理3-8行

若不指定行号，则每一行都操作。
$代表最后一行，双引号内的$代表使用变量。

3. 以正则作为模式
1). /正则表达式/， 如：/^root/
2). /正则表达式1/,/正则表达式2/
表示从第一次匹配到正则表达式1开始到第一次匹配到正则表达式2之间的所有行， 如：/^bin/,/sh$/

\u upper 大写字母
\l lower 小写字母
将文件中所有小写字母替换成大写字母:
sed  's/[a-z]/\u&/g'  /tmp/pass

###元字符
```
１）^锚定行的开始 如：/^sed/匹配所有以sed开头的行。     
２）$ 锚定行的结束 如：/sed$/匹配所有以sed结尾的行。     
３）.    匹配一个非换行符的字符 如：/s.d/匹配s后接一个任意字符，然后是d。     
４）*    匹配零或多个字符 如：/*sed/匹配所有模板是一个或多个空格后紧跟sed的行。    
５）[]   匹配一个指定范围内的字符，如/[Ss]ed/匹配sed和Sed。    
６）[^]   匹配一个不在指定范围内的字符，如：/[^A-RT-Z]ed/匹配不包含A-R和T-Z的一个字母开头，紧跟ed的行。    
７）\(..\) 保存匹配的字符，如s/\(love\)able/\1rs，loveable被替换成lovers。    
８）&   保存搜索字符用来替换其他字符，如s/love/**&**/，love这成**love**。     
９）\<  锚定单词的开始，如:/\<love/匹配包含以love开头的单词的行。     
10）\>  锚定单词的结束，如/love\>/匹配包含以love结尾的单词的行。     
11）x\{m\}  重复字符x，m次，如：/0\{5\}/匹配包含5个o的行。     
12）x\{m,\} 重复字符x,至少m次，如：/o\{5,\}/匹配至少有5个o的行。     
13）x\{m,n\}重复字符x，至少m次，不多于n次，如：/o\{5,10\}/匹配5--10个o的行。    
```

##例子
新增 a
sed '2a testContent' test.txt
在第 2 行后面新增一行内容

sed '1,3a testContent' test.txt
在原文的第 1~3 行后面各新增一行内容

替换 c
sed '2c testContent' test.txt
将第 2 行内容整行替换

sed '1,3c testContent' test.txt
将第 1~3 行内容替换成一行指定内容

删除 d
sed '2d' test.txt
删除第 2 行

sed '1,3d' test.txt
删除第1~3行

插入 i
sed '2i testContent' test.txt
在第 2 行前面插入一行内容

sed '1,3i testContent' test.txt
在原文的第 1~3 行前面各插入一行内容

打印 p
sed '2p' test.txt
重复打印第 2 行

sed '1,3p' test.txt
重复打印第1~3行

sed -n '2p' test.txt
只打印第 2 行

sed -n '1,3p' test.txt
只打印第 1~3 行

sed -n '/user/p' test.txt
打印匹配到user的行，类似grep

sed -n '/user/!p' test.txt
! 反选，打印没有匹配到user的行

sed -n 's/old/new/gp' test
只打印匹配替换的行

替换 s
sed 's/old/new/' test.txt
匹配每一行的第一个old替换为new

sed 's/old/new/gi' test.txt
匹配所有old替换为new，g 代表一行多个，i 代表匹配忽略大小写

sed '3,9s/old/new/gi' test.txt
匹配第 3~9 行所有old替换为new

写入 w
把test.txt的第一行替换为test1.txt的内容。
sed -i "" "1r test1.txt" test.txt

把test1.txt的第三，四行数据，写入到test.txt。
sed -i "" "3,4w test.txt" test1.txt 

使用sed -i对文本字符串进行增删改查
https://blog.csdn.net/yjk13703623757/article/details/79548450

sed
https://www.jianshu.com/p/4841df076697

sed使用(mac版)
https://www.jianshu.com/p/f50dc95fe4b5