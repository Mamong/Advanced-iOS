# 第四章 网络层
p134-202

4.1网络层的功能
4.1.1异构网络互联
将两个以上的计算机网络，通过一定办法，用一种或多种通信处理设备相互连接起来，以构成更大的网络系统。
中间设备包括：
1.物理层中继系统：中继器，集线器
2.数据链路层中继系统：网桥或交换机
3.网络层中继系统：路由器
4.网络层以上的中继系统：网关
网络互联通常指用路由器进行网络互联和路由器选择。虚拟的IP网。

4.1.2路由与转发
1.路由选择：按照复杂的分布式算法，根据从各相邻路由器所得到的关于整个网络拓扑的变化情况，动态地改变所选择的路由。
2.分组转发：指路由器根据转发表将用户的IP数据报从合适的端口转发出去。
路由表是根据路由选择算法得出的，转发表是从路由表得出的。转发表的结构应当使查找过程最优化，路由表则需要对网络拓扑变化的计算最优化。

4.1.3拥塞控制

4.2路由算法
4.2.1静态路由与动态路由
路由转发分组是通过路由表转发的，路由表是通过各种算法得到的。从能否随网络的通信量或拓扑自适应地进行调整变化来划分，路由算法可分为两大类：
静态路由算法（非自适应路由算法）：由网络管理员手动配置路由信息。
动态路由算法（自适应路由算法）：路由器上的路由表项是通过相互连接的路由器之间彼此交换信息，然后按照一定的算法优化出来的，而这些路由信息是在一定时间间隙里不断更新，以适应不断变化的网络，以随时获得最优的寻路效果。常用的动态路由算法：
4.2.2距离-向量路由算法
该算法中，所有节点定期将它们的整个路由选择表传送给所有与之直接相邻的节点。这种路由选择表包含：
每条路径的目的地（另一节点）
路径的代价（距离，跳数）

所有节点都监听从其他结点传送过来的路由选择更新信息，并在下列情况下更新它们的路由选择表：
1.被通告一条新的路由。
2.发送来的路由信息中有一条到达某个目的地的路由，该路由比当前使用的路由有较短的距离。这种情况下，就用经过发送路由信息的结点的新路由替换路由表中达到那个目的地的现有路由。
在通信子网上传送的路由选择信息的数量容易变得非常大。
最常见的距离-向量路由算法是RIP算法，采用跳数作为距离的度量。

4.2.3链路状态路由算法
要求每个参与该算法的结点都有完全的网络拓普信息。执行两项任务：
1.主动测试所有邻接结点的状态。
2.定期将链路状态传播给所有其他的结点。
典型的链路状态路由算法是OSPF算法。
一旦链路状态发生变化，结点对更新了的网络图利用Dijisktra最短路径算法重新计算路由，从单一的源触发计算到达所有目的结点的最短路径。
链路状态路由算法三点特征：
1.向本自治系统中所有路由发送信息，采用泛洪法，路由器通过所有端口向所有邻接的路由器发送信息。每一个收到该信息的路由又将此信息发送给所有相邻的路由（除了刚刚发来信息的那个路由）。
2.发送的信息就是与路由器相邻的所有路由器的链路状态：和谁相连以及链路度量，OSPF中只要用费用、距离、延时、带宽等。
3.只有当链路状态发生变化时，路由器才向所有路由发送此消息
优点：
独立计算，不依赖中间结点的计算；链路状态报文不加改变地传播，易于查找故障；由于链路状态报文进运载来自单个结点关于直接链路的信息，其大小与网络中的路由结点数无关。因此比距离-向量算法有更好的规模可伸展性。
比较：在距离-向量算法中每个结点仅与它的直接邻居交谈，它为它的邻居提供了从自己到网络中所有其他结点的最低费用估计。在链路状态路由算法中，每个结点通过广播的方式与所有其他结点交谈，但仅告诉它们与它直接相连的链路的费用。距离-向量算法有可能遇到路由环路等问题。

4.2.4层次路由
路由协议分为两大类：
1.一个自治系统内部所使用的路由选择协议称为内部网关协议IGP（域内路由选择），具体协议有RIP和OSPF等。
2.自治系统之间所使用的路由选择协议称为外部网关协议EGP（域间路由选择），具体协议有BGP。用于不同自治系统的路由器之间交换路由信息，并负责为分组在不同自治系统之间选择最优的路径。
使用层次路由时，OSPF将一个自治系统再划分为若干个区域，每个路由器都知道在本域内如何吧分组路由到目的地的细节，但不知道其他区域的内部结构。
采用层次划分区域虽然增加了交换信息的种类，使OSPF协议更加复杂，但却使每一个区域内部交换路由信息的通信量大大减少，使OSPF协议能够用于规模很大的自治系统。

4.3 IPv4
4.3.1 IPv4分组


4.2.2 IPv4地址与NAT

4.3.3 子网划分与子网掩码、CIDR

4.3.4 ARP协议、DHCP协议与ICMP协议

4.4 IPv6

4.5 路由协议
4.5.1 自治系统
4.5.2 域内路由与域间路由
4.5.3 RIP路由协议
4.5.4 OSPF路由协议
4.5.5 BGP路由协议

4.6 IP组播
4.6.1 组播概念
4.6.2 IP组播地址
4.6.3 IGMP协议与组播路由算法

4.7 移动IP
4.7.1 移动IP的概念
4.7.2 移动IP通信过程

4.8网络层设备
4.8.1路由器的组成和功能
4.8.2路由表与路由转发