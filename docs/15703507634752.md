ARM汇编（三）汇编程序

[TOC]

##伪指令
###伪指令的意义
* 伪指令和指令的根本区别是经过编译后会不会生成机器码。
* 伪指令的意义在于指导编译过程。

###gun伪指令
####常用gun伪指令
```
.global _start @ 给_start 外部链接属性（类似于 c 语言中的 extern 的全局声明）
.section .text @ 指定当前段为代码段
.ascii .byte .short .long .word 
.quad .float .string @ 定义数据
.equ @ 类似于 C 中宏定义（实际上在 arm-gcc 中可以用define 定义所以.equ 不常用）
```

```
.align 4 @ 以2的4次方，也就是16字节对齐
.balignl 16 0xabcdefgh @ 16字节对齐填充
```
b 表示位填充； align 表示要对齐； l 表示 long， 以 4 字节为单位填充； 16 表示
16 字节对齐； 0xdeadbeef 是用来填充的原料。

####偶尔会用到的gun伪指令
```
.end @标识文件结束
.include @ 头文件包含
.arm / .code32 @声明以下为arm指令
.thumb / .code16 @声明以下为thubm指令
```
####重要的几个伪指令
ldr 大范围的地址加载指令
adr 小范围的地址加载指令
adrl 中等范围的地址加载指令
nop 空操作
ARM中有一个ldr指令，还有一个ldr伪指令
一般都使用ldr伪指令而不用ldr指令
ldr 如果是指令则立即数前是 “#”。
ldr 如果是伪指令则立即数前是“=”， 如果是标号就不用加“=” 了。

>adr与ldr
adr编译时会被1条sub或add指令替代，而ldr编译时会被一条mov指令替代或者文字池方式处理；
adr总是以PC为基准来表示地址，因此指令本身和运行地址有关，可以用来检测程序当前的运行地址在哪里
ldr加载的地址和链接时给定的地址有关，由链接脚本决定。
ldr 加载的地址在链接时确定，而adr加载的地址在运行时确定；所以我们可以通过adr和ldr加载的地址比较来判断当前程序是否在链接时指定的地址运行。

####标签使用
```
ldr r0, lable    //取标签处的值即88888
ldr r1, =lable   //取标签的地址
lable:
    .word 88888
```
###ads伪指令
最常见几个伪指令 AREA,EQU,DCB,END,ENTRY,EXPORT,GOBEL,IMPORT,

常见伪定义
DCB 定义字符中
Str DCB “hello, world “

##ARM程序结构 
###ARM汇编程序结构

源代码由文本文件组成.按照汇编的编译器不同,分为两大量,一类是ADS的汇编程序,一类是GNU汇编格式,两者在指令集是完成一样,但是在伪指令.程序结构等方法各不同相同.

###GNU汇编
####gnu汇编符号
gnu汇编中的一些符号：
* @ 用来做注释。 可以在行首也可以在代码后面同一行直接跟， 和 C语言中//类似
* \# 做注释， 一般放在行首， 表示这一行都是注释而不是代码。
* ： 以冒号结尾的是标号
* . 点号在 gnu 汇编中表示当前指令的地址
* \# 立即数前面要加#或$， 表示这是个立即数


###ADS汇编
本节主要是讲解ADS汇编格式.

ADS汇编程序,主要包含如下几类程序
* 汇编源程序,后缀名是.S
* 汇编包含文件,后缀名是.inc
* 如果是与C混和编程..C,.h也能识别

####ADS 汇编语句格式

 [标号]  <指令|条件|S> <操作数> [;注释]

1. 所有标号顶格写,而指令和伪指令不能顶格写
2. 标识符(标号,指令)大小写敏感,所以要在标号和指令时书写一致,一般伪指令,指令,寄存器名可以全部为大写
3. 注释以;开头,可以顶格写
4. 可以使用\来分行写太长语句
5. 变量,常量的定义必须在一行顶格写

####常量的书写
* 数字常量
在程序中直接写数字 ,十进制 12,256,十六进制 0x1228,

* 字符常量
类似于C的定义,用SETS来定义字符常量
HELLO SETS “hello,the world!”

* 逻辑常量
逻辑真为{TRUE},逻辑假为{FLASE}
Testno SETS {TURE}

####汇编程序的段定义
任何一个程序都要分段,C语言一般由编译器自动分段,(分成.Text,.Data段之类),但在汇编程序这样的底层程序中,由开发者自行分段.  它包含如下段
* 至少一个代码段,并且代码段是只读的,对应(.Text)
* 数据段可以没有,也可以有多个.
* 每一个段用END结束

AREA 定义一个段
* 格式：AREA  段名    属性1, 属性2,
例子:AREA Init，CODE，READONLY

* ENTRY 指明一个段的入口
* END结束一个段

 
```
ABC EQU 0x12

    AREA Example,CODE,READONLY

    ENTRY

START MOV R7,#10

  MOV R6,#5

  ADD R6,R6,R7

  B   

  END
```

####ADS ARM汇编程序格式要求

1.  所有标号要顶格写.
2.  所有指令不能顶格写,一般插入Tab键在行首
3.  ADS ARM中,是大小写敏感的.建议标号,指令,伪指令,寄存器名全部为大写
4.  注释采用;打头
5.  每个程序至少有一个AREA在代码里(READONLY)
6.  每个段都要用END结束(不能顶格)


