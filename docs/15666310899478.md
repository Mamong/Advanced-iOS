OpenGL(三)-OpenGL渲染流程解析

[TOC]

![](https://upload-images.jianshu.io/upload_images/2500437-0c36abf51a1037da.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/637)

OpenGL的渲染管线有哪些阶段,Shader(着色语言)到底发生在哪个阶段，这是OpenGL初学者需要搞清楚的。所以理解OpenGL渲染流程是非常有必要的。

![](https://upload-images.jianshu.io/upload_images/2500437-d20d14ca8027cd62.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000)

上图是OpenGL渲染架构图,我们在处理任何图形渲染,都是依据它。基于OpenGL 封装的框架都是也都是遵循这个图的规则。

##一、客户端,服务端

从图中我们得知,管线分为上下2部分，上部分是客户端，而下半部分则是服务端。
客户端是存储在CPU存储器中的，并且在应用程序中执行，或者在主系统内存的驱动程序中执行。驱动程序会将渲染命令和数据组合起来，发送给服务器执行。
服务器就是实际上就是图形加速卡上的硬件和内存。
服务器 和 客户机在功能上也是异步的。 它们是各自独立的软件块或硬件块。我们是希望它们2个端都尽量在不停的工作。客户端不断的把数据块和命令块组合在一起输送到缓冲区，然后缓冲区就会发送到服务器执行。
如果服务器停止工作等待客户机，或者客户机停止工作来等待服务器做好接受更多的命令和准备，我们把这种情况成为管线停滞

##着色器
Vertex Shader(顶点着色器) 和 Fragment Shader(片段着色器)。

顶点着色器处理从客户机输入的数据、应用变换、进行其他的类型的数学运算来计算关照效果、位移、颜色值等等。（eg:为了渲染共有3个顶点的三角形，顶点着色器将执行3次，也就是为了每个顶点执行一次）在目前的硬件上有多个执行单元同时运行，就意味着所有的3个顶点可以同时进行处理。

上图中primitive Assembly 说明的是：3个顶点已经组合在一起，而三角形已经逐个片段的进行了光栅化。
每个片段通过执行片元着色器进行填充。片元着色器会输出我们将屏幕上看到的最终颜色值。

##OpenGL 着色器传递渲染数据的方式
###属性
属性就是对每一个顶点都要作改变的数据元素。
特点:
1.属性值可以是浮点数、整数、布尔数据。
2.属性总是以四维向量的形式进行内部存储的。
3.这些属性对每个顶点都要做改变，但并不意味着它们的值不能重复。通常情况下，它们都是不一样的，但有可能整个数组都是同一值的情况。
属性可以是：顶点位置,纹理坐标、颜色值、关照计算表面法线等等

###uniform值
uniform是一种对整个批次属性都取统一的单一值。
它是不变的。通过设置uniform变量就紧接着发送一个图元批次命令，Uniform变量实际上可以无数次限制地使用，设置一个应用于整个表面的单个颜色值，还可以设置一个时间值。在每次渲染某种类型的顶点动画时修改它。
注意：这里的uniform 变量每个批次改变一次，而不是每个顶点改变一次。
uniform变量最常见的应用是在顶点渲染中设置变换矩阵
与属性相同点：可以是浮点值、整数、布尔值
与属性不同点：顶点着色器和片元着色器都可以使用uniform变量。uniform 变量还可以是标量类型、矢量类型、uniform矩阵。

###纹理

在顶点着色器、片段着色器中都可以对纹理数据进行采样和筛选。
典型的应用场景：片段着色器对一个纹理值进行采样，然后在一个三角形表面应用渲染纹理数据。
纹理数据，不仅仅表现在图形，很多图形文件格式都是以无符号字节（每个颜色通道8位）形式对颜色分量进行存储的。